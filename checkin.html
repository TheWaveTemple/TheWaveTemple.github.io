<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Guest Check-In System</title>
 <style>
    :root {
      --primary: #6CC9C3;
      --primary-dark: #5BB5AF;
      --secondary: #64748b;
      --light: #f8fafc;
      --dark: #0f172a;
      --border: #cbd5e1;
      --success: #10b981;
      --error: #ef4444;
      --radius: 8px;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background: linear-gradient(135deg, #f1f5f9, #e2e8f0); color: var(--dark); padding: 20px; min-height: 100vh; }
    .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
    
    .hidden { display: none !important; }

    .header { text-align: center; margin-bottom: 30px; padding: 20px; background: white; border-radius: var(--radius); box-shadow: var(--shadow); }
	 .header img { max-height: 70px; width: auto; }
    .header h1 { color: var(--primary); margin-bottom: 10px; }
    .form-container { background: white; border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; margin-bottom: 30px; }
    .form-header { display: flex; justify-content: space-between; align-items: center; padding: 20px; background: var(--primary); color: white; }
    #lang-switcher { padding: 8px 12px; border-radius: var(--radius); border: none; background: white; cursor: pointer; font-weight: bold; }
    
    form { padding: 20px; }
    .form-section { margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid var(--border); }
    .form-section h3 { margin-bottom: 15px; color: var(--primary); font-size: 1.2rem; display: flex; align-items: center; }
    .form-section h3 i { margin-right: 10px; }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
    .form-group { display: flex; flex-direction: column; }
    .full-width { grid-column: 1 / -1; }
    label { margin-bottom: 5px; font-weight: 500; font-size: 0.9rem; }
    input, select { padding: 10px 12px; border: 1px solid var(--border); border-radius: var(--radius); font-size: 1rem; }
    
    .signature-container { border: 1px solid var(--border); border-radius: var(--radius); padding: 15px; background: #fcfcfc; }
    #signature-pad { width: 100%; height: 150px; border: 1px solid var(--border); border-radius: var(--radius); background: #ffffff; touch-action: none; cursor: crosshair; }
    
    .btn-primary { background: var(--primary); color: white; border: none; padding: 15px 24px; border-radius: var(--radius); cursor: pointer; font-weight: 600; width: 100%; font-size: 1.1rem; }
    .btn-primary:disabled { background: var(--secondary); opacity: 0.7; cursor: not-allowed; }
    
    .spinner { 
        width: 24px; height: 24px; 
        border: 3px solid rgba(255,255,255,0.3); 
        border-top: 3px solid white; 
        border-radius: 50%; 
        animation: spin 1s linear infinite; 
        display: inline-block; 
        vertical-align: middle; 
        margin-left: 10px;
    }
    
    .uppercase { text-transform: uppercase; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @media (max-width: 768px) { .form-grid { grid-template-columns: 1fr; } }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="https://static.wixstatic.com/media/91a755_ebad918f50374773afafffd4990151d4~mv2.png/v1/crop/x_0,y_28,w_1322,h_325/fill/w_470,h_116,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/logo_pinzell_hor_Mesa%20de%20trabajo%201.png" alt="Hotel Logo">
    </div>
    
    <div class="form-container">
      <div class="form-header">
        <h2><i class="fas fa-user-check"></i> <span data-i18n="regTitle">Registration</span></h2>
        <select id="lang-switcher">
          <option value="en">English</option>
          <option value="es">Español</option>
          <option value="fr">Français</option>
          <option value="de">Deutsch</option>
        </select>
      </div>
      
      <form id="checkin-form">
        <input type="hidden" name="contractDate" id="contractDate">

        <div class="form-section">
          <h3><i class="fas fa-user-circle"></i> <span data-i18n="personalInfo">Personal Information</span></h3>
          <div class="form-grid">
            <div class="form-group"><label data-i18n="fullName">Name</label><input type="text" name="name" required class="uppercase"></div>
            <div class="form-group"><label data-i18n="surname">First Surname</label><input type="text" name="surname1" required class="uppercase"></div>
            <div class="form-group"><label data-i18n="secondSurname">Second Surname</label><input type="text" name="surname2" class="uppercase"></div>
            <div class="form-group">
              <label data-i18n="nationality">Nationality</label>
              <input type="text" name="nationality" list="iso-countries" placeholder="ESP" pattern="[A-Z]{3}" maxlength="3" required class="uppercase">
            </div>
            <div class="form-group"><label data-i18n="dob">Date of Birth</label><input type="date" name="dob" required></div>
            <div class="form-group">
              <label data-i18n="gender">Gender</label>
              <select name="gender" required>
                <option value="" data-i18n="select">Select...</option>
                <option value="M" data-i18n="male">Male</option>
                <option value="F" data-i18n="female">Female</option>
                <option value="O" data-i18n="other">Other</option>
              </select>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3><i class="fas fa-id-card"></i> <span data-i18n="docTitle">Documentation</span></h3>
          <div class="form-grid">
            <div class="form-group">
              <label data-i18n="documentType">Type</label>
              <select name="documentType" id="docTypeSelect" onchange="toggleSupportField()" required>
                <option value="" data-i18n="select">Select...</option>
                <option value="DNI">DNI (Spain)</option>
                <option value="NIE">NIE (Spain)</option>
                <option value="PAS">Passport</option>
                <option value="OTRO" data-i18n="otherDoc">Other</option>
              </select>
            </div>
            <div class="form-group"><label data-i18n="documentId">Number</label><input type="text" name="document" required class="uppercase"></div>
            <div class="form-group hidden" id="support-group">
              <label style="color:var(--primary-dark)" data-i18n="supportNumber">Support Number (9 chars)</label>
              <input type="text" name="supportNumber" id="supportNumber" maxlength="9" pattern=".{9}" class="uppercase">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3><i class="fas fa-home"></i> <span data-i18n="addressInfo">Address</span></h3>
          <div class="form-grid">
            <div class="form-group full-width"><label data-i18n="address">Address</label><input type="text" name="address" required></div>
            <div class="form-group"><label data-i18n="city">City</label><input type="text" name="city" required></div>
            <div class="form-group"><label data-i18n="postalCode">Postal Code</label><input type="text" name="postalCode" required></div>
            <div class="form-group">
              <label data-i18n="country">Country (ISO 3)</label>
              <input type="text" name="country" list="iso-countries" placeholder="ESP" pattern="[A-Z]{3}" maxlength="3" required class="uppercase">
            </div>
            <div class="form-group"><label data-i18n="email">Email</label><input type="email" name="email" required></div>
             <div class="form-group"><label data-i18n="phone">Phone</label><input type="tel" name="phone"></div>
          </div>
        </div>

        <div class="form-section">
          <h3><i class="fas fa-credit-card"></i> <span data-i18n="stayInfo">Stay & Payment</span></h3>
          <div class="form-grid">
            <div class="form-group"><label data-i18n="checkinDate">Check-in</label><input type="date" name="checkinDate" id="checkinDate" required></div>
            <div class="form-group"><label data-i18n="checkoutDate">Check-out</label><input type="date" name="checkoutDate" id="checkoutDate" required></div>
            <div class="form-group">
                <label data-i18n="paymentType">Payment</label>
                <select name="paymentType" required>
                    <option value="PLATF" data-i18n="payPlatform">Platform</option>
                    <option value="TARJT" data-i18n="payCard">Card</option>
                    <option value="EFECT" data-i18n="payCash">Cash</option>
                </select>
            </div>
          </div>
        </div>
        
        <div class="form-section">
          <h3><i class="fas fa-pen-nib"></i> <span data-i18n="signature">Signature</span></h3>
          <div class="signature-container">
            <canvas id="signature-pad"></canvas>
            <div style="text-align:right; margin-top:10px;">
              <button type="button" onclick="clearSignature()" data-i18n="clear" style="padding:5px 10px; cursor:pointer;">Clear</button>
            </div>
          </div>
        </div>

        <button type="submit" class="btn-primary" id="submit-btn">
          <span id="btn-text" data-i18n="submit">Submit Registration</span>
          <div id="btn-spinner" class="spinner hidden"></div>
        </button>
      </form>
    </div>
  </div>

  <datalist id="iso-countries"></datalist>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // --- LISTA DE PAÍSES ---
    const countryList = {
        "AFG":"Afghanistan", "ALB":"Albania", "DZA":"Algeria", "AND":"Andorra", "AGO":"Angola", "ARG":"Argentina", "ARM":"Armenia", "AUS":"Australia", "AUT":"Austria", "AZE":"Azerbaijan",
        "BEL":"Belgium", "BEN":"Benin", "BOL":"Bolivia", "BRA":"Brazil", "BGR":"Bulgaria", "CAN":"Canada", "CHL":"Chile", "CHN":"China", "COL":"Colombia", "CRI":"Costa Rica", "HRV":"Croatia",
        "CUB":"Cuba", "CYP":"Cyprus", "CZE":"Czech Republic", "DNK":"Denmark", "DOM":"Dominican Republic", "ECU":"Ecuador", "EGY":"Egypt", "SLV":"El Salvador", "EST":"Estonia", "FIN":"Finland",
        "FRA":"France", "GEO":"Georgia", "DEU":"Germany", "GRC":"Greece", "GTM":"Guatemala", "HND":"Honduras", "HUN":"Hungary", "ISL":"Iceland", "IND":"India", "IDN":"Indonesia", "IRL":"Ireland",
        "ISR":"Israel", "ITA":"Italy", "JAM":"Jamaica", "JPN":"Japan", "JOR":"Jordan", "KAZ":"Kazakhstan", "KEN":"Kenya", "KOR":"South Korea", "KWT":"Kuwait", "LVA":"Latvia", "LTU":"Lithuania",
        "LUX":"Luxembourg", "MEX":"Mexico", "MCO":"Monaco", "MAR":"Morocco", "NLD":"Netherlands", "NZL":"New Zealand", "NIC":"Nicaragua", "NOR":"Norway", "PAN":"Panama", "PRY":"Paraguay",
        "PER":"Peru", "PHL":"Philippines", "POL":"Poland", "PRT":"Portugal", "PSE":"Palestine", "ROU":"Romania", "RUS":"Russia", "SAU":"Saudi Arabia", "SEN":"Senegal", "SRB":"Serbia", "SGP":"Singapore",
        "SVK":"Slovakia", "SVN":"Slovenia", "ZAF":"South Africa", "ESP":"Spain", "SWE":"Sweden", "CHE":"Switzerland", "THA":"Thailand", "TUN":"Tunisia", "TUR":"Turkey", "UKR":"Ukraine",
        "ARE":"United Arab Emirates", "GBR":"United Kingdom", "USA":"United States", "URY":"Uruguay", "VEN":"Venezuela", "VNM":"Vietnam"
    };

    const datalist = document.getElementById('iso-countries');
    Object.entries(countryList).forEach(([code, name]) => {
        const opt = document.createElement('option');
        opt.value = code; opt.textContent = name;
        datalist.appendChild(opt);
    });

    // --- TRADUCCIONES ---
    const translations = {
      en: {
        formTitle: "Guest Registration Form",
        regTitle: "Registration", personalInfo: "Personal Details",
        fullName: "Name", surname: "1st Surname", secondSurname: "2nd Surname", nationality: "Nationality",
        dob: "Birth Date", gender: "Gender", select: "Select...", male: "Male", female: "Female", other: "Other",
        docTitle: "ID Document", documentType: "Type", otherDoc: "Other ID", documentId: "Number",
        supportNumber: "Support No.", addressInfo: "Address", address: "Street", city: "City",
        postalCode: "Postcode", country: "Country", email: "Email", phone: "Phone", stayInfo: "Stay & Payment",
        checkinDate: "Check-in Date", checkoutDate: "Check-out Date", paymentType: "Payment Method", payPlatform: "Booking/Airbnb/Online",
        payCard: "Card", payCash: "Cash", signature: "Signature", clear: "Clear", submit: "Submit",
        legalText: "This information is collected to comply with Spanish law (Real Decreto 933/2021) for security purposes."
      },
      es: {
        formTitle: "Hoja de Registro de Huésped",
        regTitle: "Registro", personalInfo: "Datos Personales",
        fullName: "Nombre", surname: "1er Apellido", secondSurname: "2do Apellido", nationality: "Nacionalidad",
        dob: "Fecha Nacimiento", gender: "Género", select: "Seleccionar...", male: "Hombre", female: "Mujer", other: "Otro",
        docTitle: "Documentación", documentType: "Tipo", otherDoc: "Otro Documento", documentId: "Número",
        supportNumber: "Nº Soporte", addressInfo: "Dirección", address: "Calle", city: "Ciudad",
        postalCode: "Código Postal", country: "País", email: "Email", phone: "Teléfono", stayInfo: "Estancia y Pago",
        checkinDate: "Fecha de entrada", checkoutDate: "Fecha de salida", paymentType: "Forma de Pago", payPlatform: "Booking/Airbnb/Online",
        payCard: "Tarjeta", payCash: "Efectivo", signature: "Firma", clear: "Borrar", submit: "Enviar",
        legalText: "Esta información se recopila para cumplir con la ley española (Real Decreto 933/2021) con fines de seguridad."
      },
      fr: {
        formTitle: "Fiche d'Enregistrement",
        regTitle: "Enregistrement", personalInfo: "Infos Personnelles",
        fullName: "Prénom", surname: "Nom", secondSurname: "Deuxième Nom", nationality: "Nationalité",
        dob: "Date Naissance", gender: "Genre", select: "Sélectionner...", male: "Homme", female: "Femme", other: "Autre",
        docTitle: "Pièce d'identité", documentType: "Type", otherDoc: "Autre ID", documentId: "Numéro",
        supportNumber: "Nº Support", addressInfo: "Adresse", address: "Rue", city: "Ville",
        postalCode: "Code Postal", country: "Pays", email: "E-mail", phone: "Téléphone", stayInfo: "Séjour et Paiement",
        checkinDate: "Date d'arrivée", checkoutDate: "Date de départ", paymentType: "Paiement", payPlatform: "Booking/Airbnb/Online",
        payCard: "Carte", payCash: "Espèces", signature: "Signature", clear: "Effacer", submit: "Envoyer",
        legalText: "Ces informations sont collectées pour se conformer à la loi espagnole (Real Decreto 933/2021) à des fins de sécurité."
      },
      de: {
        formTitle: "Anmeldeformular",
        regTitle: "Anmeldung", personalInfo: "Persönliche Daten",
        fullName: "Vorname", surname: "Nachname", secondSurname: "Zweiter Nachname", nationality: "Nationalität",
        dob: "Geburtsdatum", gender: "Geschlecht", select: "Wählen...", male: "Männlich", female: "Weiblich", other: "Andere",
        docTitle: "Ausweisdokument", documentType: "Typ", otherDoc: "Anderes Dokument", documentId: "Nummer",
        supportNumber: "Support-Nr.", addressInfo: "Adresse", address: "Straße", city: "Stadt",
        postalCode: "Postleitzahl", country: "Land", email: "E-Mail", phone: "Telefon", stayInfo: "Aufenthalt & Zahlung",
        checkinDate: "Check-in Datum", checkoutDate: "Check-out Datum", paymentType: "Zahlungsart", payPlatform: "Booking/Airbnb/Online",
        payCard: "Karte", payCash: "Barzahlung", signature: "Unterschrift", clear: "Löschen", submit: "Absenden",
        legalText: "Diese Informationen werden gemäß dem spanischen Gesetz (Real Decreto 933/2021) zu Sicherheitszwecken erhoben."
      }
    };

    function applyTranslations(lang) {
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        if (translations[lang][key]) el.textContent = translations[lang][key];
      });
    }
    document.getElementById("lang-switcher").addEventListener("change", e => applyTranslations(e.target.value));
    applyTranslations("en");

    // --- ASIGNAR FECHA DE CONTRATO ---
    window.addEventListener('DOMContentLoaded', () => {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('contractDate').value = today;
    });

    // --- LÓGICA DE FORMULARIO ---
    function toggleSupportField() {
      const type = document.getElementById('docTypeSelect').value;
      const group = document.getElementById('support-group');
      const input = document.getElementById('supportNumber');
      if (type === 'DNI' || type === 'NIE') { // Corregido NIF por DNI para que coincida con el value
        group.classList.remove('hidden'); input.required = true;
      } else {
        group.classList.add('hidden'); input.required = false; input.value = '';
      }
    }

    document.querySelectorAll('.uppercase').forEach(input => {
        input.addEventListener('input', () => input.value = input.value.toUpperCase());
    });

    // --- FIRMA ---
    const canvas = document.getElementById('signature-pad');
    const ctx = canvas.getContext('2d');
    let drawing = false;
    
    const resizeCanvas = () => {
      const ratio = window.devicePixelRatio || 1;
      canvas.width = canvas.offsetWidth * ratio;
      canvas.height = canvas.offsetHeight * ratio;
      ctx.scale(ratio, ratio);
      clearSignature(); // Resetea el canvas al redimensionar
    };
    
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
    
    const getCoordinates = (event) => {
      const rect = canvas.getBoundingClientRect();
      let x, y;
      if (event.type.includes('mouse')) {
        x = event.clientX - rect.left;
        y = event.clientY - rect.top;
      } else if (event.touches) {
        x = event.touches[0].clientX - rect.left;
        y = event.touches[0].clientY - rect.top;
      }
      return { x, y };
    };

    const startDrawing = (event) => { drawing = true; const { x, y } = getCoordinates(event); ctx.beginPath(); ctx.moveTo(x, y); event.preventDefault(); };
    const draw = (event) => { if (!drawing) return; const { x, y } = getCoordinates(event); ctx.lineTo(x, y); ctx.stroke(); event.preventDefault(); };
    const stopDrawing = () => { drawing = false; };

    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
    canvas.addEventListener('touchstart', startDrawing);
    canvas.addEventListener('touchmove', draw);
    canvas.addEventListener('touchend', stopDrawing);
    
    function clearSignature() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 2;
    }

    // --- ENVÍO Y GENERACIÓN DE PDF ROBUSTA ---
    document.getElementById('checkin-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const btn = document.getElementById('submit-btn');
      const text = document.getElementById('btn-text');
      const spin = document.getElementById('btn-spinner');
      const form = e.target;
      const lang = document.getElementById('lang-switcher').value;
      
      btn.disabled = true; 
      spin.classList.remove('hidden'); 
      text.style.opacity = "0.5";
      
      try {
        const formData = new FormData(form);
        const signatureDataUrl = canvas.toDataURL();
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // --- 1. GENERACIÓN DEL PDF (Estilo Checkin.html pero adaptado) ---
        
        // Título y Fecha Contrato
        doc.setFontSize(16);
        doc.text(translations[lang].formTitle, 105, 15, null, null, 'center');
        doc.setFontSize(10);
        doc.text(`Contract Date: ${formData.get('contractDate')}`, 105, 22, null, null, 'center');
        
        doc.setFontSize(12);
        
        // Sección: Información Personal
        doc.setFont(undefined, 'bold');
        doc.text(translations[lang].personalInfo + ":", 14, 30);
        doc.setFont(undefined, 'normal');
        
        let y = 38;
        const lineHeight = 7;
        
        // Mapeo manual para controlar el orden y añadir campos nuevos (supportNumber)
        const personalData = [
            { l: translations[lang].fullName, v: formData.get('name') },
            { l: translations[lang].surname, v: formData.get('surname1') },
            { l: translations[lang].secondSurname, v: formData.get('surname2') },
            { l: translations[lang].nationality, v: formData.get('nationality') },
            { l: translations[lang].dob, v: formData.get('dob') },
            { l: translations[lang].gender, v: formData.get('gender') },
            { l: translations[lang].documentType, v: formData.get('documentType') },
            { l: translations[lang].documentId, v: formData.get('document') }
        ];

        // Añadir supportNumber si existe
        if(formData.get('supportNumber')) {
            personalData.push({ l: translations[lang].supportNumber, v: formData.get('supportNumber') });
        }

        personalData.forEach(item => {
            if(y > 270) { doc.addPage(); y = 20; }
            doc.text(`${item.l}: ${item.v || '-'}`, 20, y);
            y += lineHeight;
        });

        // Sección: Dirección y Contacto
        y += 5;
        doc.setFont(undefined, 'bold');
        doc.text(translations[lang].addressInfo + ":", 14, y);
        doc.setFont(undefined, 'normal');
        y += lineHeight;

        const addressData = [
            { l: translations[lang].address, v: formData.get('address') },
            { l: translations[lang].city, v: formData.get('city') },
            { l: translations[lang].postalCode, v: formData.get('postalCode') },
            { l: translations[lang].country, v: formData.get('country') },
            { l: translations[lang].email, v: formData.get('email') },
            { l: translations[lang].phone, v: formData.get('phone') }
        ];

        addressData.forEach(item => {
             if(y > 270) { doc.addPage(); y = 20; }
            doc.text(`${item.l}: ${item.v || '-'}`, 20, y);
            y += lineHeight;
        });

        // Sección: Estancia y Pago
        y += 5;
        doc.setFont(undefined, 'bold');
        doc.text(translations[lang].stayInfo + ":", 14, y);
        doc.setFont(undefined, 'normal');
        y += lineHeight;

        const stayData = [
            { l: translations[lang].checkinDate, v: formData.get('checkinDate') },
            { l: translations[lang].checkoutDate, v: formData.get('checkoutDate') },
            { l: translations[lang].paymentType, v: formData.get('paymentType') }
        ];

        stayData.forEach(item => {
            doc.text(`${item.l}: ${item.v || '-'}`, 20, y);
            y += lineHeight;
        });

        // Sección: Firma
        y += 10;
        if(y > 230) { doc.addPage(); y = 20; } // Asegurar espacio para firma
        doc.setFont(undefined, 'bold');
        doc.text(translations[lang].signature + ":", 14, y);
        y += 5;
        doc.addImage(signatureDataUrl, 'PNG', 20, y, 60, 30);
        y += 40;

        // Texto Legal
        doc.setFontSize(9);
        doc.setFont(undefined, 'normal');
        doc.setTextColor(100);
        const splitTitle = doc.splitTextToSize(translations[lang].legalText, 180);
        doc.text(splitTitle, 14, y);

        // Generar nombre de archivo
        const guestName = formData.get('name') || 'Guest';
        const guestSurname = formData.get('surname1') || 'Name';
        const timestamp = new Date().toISOString().split('T')[0];
        const filename = `${guestSurname.replace(/\s+/g, '_')}_${guestName.replace(/\s+/g, '_')}_${timestamp}.pdf`;
        
        // Convertir a Base64 para subida
        const pdfBlob = doc.output('blob');
        const base64Pdf = await new Promise((resolve) => {
          const reader = new FileReader();
          reader.onloadend = () => resolve(reader.result.split(',')[1]);
          reader.readAsDataURL(pdfBlob);
        });

        // --- 2. SUBIDA A GOOGLE DRIVE (Fetch) ---
        const uploadResponse = await fetch("https://script.google.com/macros/s/AKfycbwmnSIcC_Lx5LBbh-Z8VPdsLnhe-a6c2HXr9eNBDFNScEs5EyRQyLx4svxjPn61UKj7YA/exec", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({
            filename: filename,
            mimeType: "application/pdf",
            data: base64Pdf,
            // Mapeo de datos para el script (manteniendo compatibilidad)
            contractDate: formData.get('contractDate'),
            name: formData.get('name'),
            surname1: formData.get('surname1'),
            surname2: formData.get('surname2'),
            nationality: formData.get('nationality'),
            dob: formData.get('dob'),
            gender: formData.get('gender'),
            documentType: formData.get('documentType'),
            document: formData.get('document'),
            supportNumber: formData.get('supportNumber'), // Nuevo campo
            email: formData.get('email'),
            phone: formData.get('phone'),
            address: formData.get('address'),
            city: formData.get('city'),
            province: formData.get('province') || '', // No está en form 5 pero el script podría esperarlo
            postalCode: formData.get('postalCode'),
            country: formData.get('country'),
            checkinDate: formData.get('checkinDate'),
            checkoutDate: formData.get('checkoutDate'),
            paymentType: formData.get('paymentType') // Nuevo campo
          })
        });

        const responseText = await uploadResponse.text();
        
        if (responseText.includes("Success")) {
          alert(`Registration submitted successfully for ${guestName}!`);		  
          form.reset();
          clearSignature();
          document.getElementById('contractDate').value = timestamp; // Restaurar fecha oculta
          document.getElementById('support-group').classList.add('hidden'); // Ocultar campo soporte
          window.scrollTo({ top: 0, behavior: 'smooth' });
        } else {
          alert("Error from server: " + responseText);
        }

      } catch (error) {
        console.error(error);
        alert("An error occurred: " + error.message);
      } finally {
        btn.disabled = false;
        spin.classList.add('hidden');
        text.style.opacity = "1";
      }
    });
  </script>
</body>
</html>
